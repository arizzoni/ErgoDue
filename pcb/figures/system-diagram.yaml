# diagram:
#   label: ErgoDue Architecture
#   label_position: top
#   font_family: Iosevka Aile
#   font_weight: bold

rows:

  - [~, input_port_controller, hub_controller, microcontroller, flash, ~]
  - [input_port, input_mux, hub_controller, microcontroller, gpio, keys]
  - [~, output_port_controller0, hub_controller, microcontroller, led0, leds]
  - [output_port0, output_mux0, hub_controller, microcontroller, led1, leds]
  - [~, output_port_controller1, hub_controller, microcontroller, led2, leds]
  - [output_port1, output_mux1, hub_controller, ~, ~, ~]
  - [~, output_port_controller2, hub_controller, ~, ~, ~]
  - [output_port2, output_mux2, hub_controller, ~, ~, ~]

blocks:
  - name: upstream
    label: USB 3.1/2.0 Upstream

  - name: input_port_controller
    label: USB-C Port Controller

  - name: hub_controller
    label: USB Hub Controller

  - name: output_port_controller0
    label: USB-C Port Controller

  - name: output_port_controller1
    label: USB-C Port Controller

  - name: output_port_controller2
    label: USB-C Port Controller

  - name: microcontroller
    label: Microcontroller

  - name: flash
    label: Flash Memory

  - name: gpio
    label: GPIO Expander

  - name: led0
    label: LED Driver

  - name: led1
    label: LED Driver

  - name: led2
    label: LED Driver

  - name: keys
    label: Keyswitch Matrix

  - name: leds
    label: LED Matrix

  - name: input_port
    label: USB-C Port

  - name: output_port0
    label: USB-C Port

  - name: output_port1
    label: USB-C Port

  - name: output_port2
    label: USB-C Port

  - name: input_mux
    label: Input MUX

  - name: output_mux0
    label: Output MUX

  - name: output_mux1
    label: Output MUX

  - name: output_mux2
    label: Output MUX

connections:

  - start: hub_controller
    end: microcontroller
    middle_label: SPI0
    arrow_back: true

  - start: hub_controller
    end: microcontroller
    middle_label: USB 2.0
    arrow_back: true

  - start: hub_controller
    end: input_port_controller
    arrow_back: true

  - start: hub_controller
    end: output_port_controller0
    arrow_back: true

  - start: hub_controller
    end: output_port_controller1
    arrow_back: true
  
  - start: hub_controller
    end: output_port_controller2
    arrow_back: true

  - start: flash
    end: microcontroller
    middle_label: QuadSPI
    arrow_back: true

  - start: gpio
    end: microcontroller
    middle_label: I2C0

  - start: keys
    end: gpio

  - start: led0
    end: leds
    middle_label: Red

  - start: led1
    end: leds
    middle_label: Green 

  - start: led2
    end: leds
    middle_label: Blue

  - start: microcontroller
    end: led0
    middle_label: I2C0

  - start: microcontroller
    end: led1
    middle_label: I2C0

  - start: microcontroller
    end: led2
    middle_label: I2C0

  - start: input_port
    end: input_port_controller
    arrow_back: true

  - start: input_port
    end: input_mux
    arrow_back: true

  - start: output_port0
    end: output_port_controller0
    arrow_back: true

  - start: output_port0
    end: output_mux0
    arrow_back: true

  - start: output_port1
    end: output_port_controller1
    arrow_back: true

  - start: output_port1
    end: output_mux1
    arrow_back: true

  - start: output_port2
    end: output_port_controller2
    arrow_back: true

  - start: output_port2
    end: output_mux2
    arrow_back: true

  - start: input_mux
    end: hub_controller
    arrow_back: true
    middle_label: USB 3.1/2.0

  - start: output_mux0
    end: hub_controller
    arrow_back: true
    middle_label: USB 3.1/2.0

  - start: output_mux1
    end: hub_controller
    arrow_back: true
    middle_label: USB 3.1/2.0

  - start: output_mux2
    end: hub_controller
    arrow_back: true
    middle_label: USB 3.1/2.0

styles:
  
  default_block:
    font_family: Iosevka Aile Light
    fill: [0.95, 0.95, 0.95]

  default_connection:
    font_family: Iosevka Aile Light Oblique
    entrances: [LEFT, RIGHT]
    exits: [LEFT, RIGHT]
